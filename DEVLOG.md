# Журнал разработки

## 2025-08-21
- Распакованы архивы `subs-mvp-2025-08-21.zip` и `subs-db-kit-2025-08-21 (1).zip` в одноимённые директории.
- Исходные файлы не изменялись, сохранена структура каталогов.

## 2025-08-22
- Добавлен workflow `build-subs.yml` для сборки образа `subs` в GHCR.
- Добавлен файл `.dockerignore` для каталога `subs-mvp`, исключающий лишние файлы из контекста сборки.
- Переименована директория `subs-mvp-2025-08-21` в `subs-mvp`.
- Исправлена ошибка пуша образа в GHCR: имя владельца репозитория приводится к нижнему регистру перед тегированием.
- Исправлен импорт настроек на `pydantic-settings` и обновлены зависимости проекта.
- Добавлен workflow `ci-subs.yml` со смоук-тестом импорта и сборкой образа.
- Актуализирован `.dockerignore` для каталога `subs-mvp`.

## 2025-08-23
- Добавлены идемпотентные SQL-миграции (`pools`, `uids`, `uid_assignments`, `uid_sources`, `configmap_sync_state` и функции `subs_*`).
- Подготовлен Kubernetes Job `subs-migrate` и `kustomization.yaml` для применения миграций.
- Настроен `AsyncConnectionPool` с ручным открытием/закрытием на старте/остановке сервиса.
- Расширен CI: поднимается сервис PostgreSQL, выполняется смоук-тест открытия пула и простого запроса, образ публикуется в GHCR.
- Обновлена документация по запуску миграций и деплою.
